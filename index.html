<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ton City - Flat 2D</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --primary: #0088cc;
            --bg-dark: #0b141d; /* Fondo m√°s s√≥lido, menos gradiente */
            --card-flat: #17212b; /* Estilo Telegram Desktop */
            --text-main: #ffffff;
            --text-dim: #708499;
            --accent-green: #31b545;
            --energy-yellow: #f1c40f;
            --border-color: #242f3d;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            padding: 16px;
            display: flex;
            flex-direction: column;
            align-items: center;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- HEADER 2D --- */
        .header {
            width: 100%;
            max-width: 420px;
            margin-bottom: 20px;
        }

        #user-display {
            text-align: center;
            font-size: 0.9rem;
            color: var(--primary);
            margin-bottom: 8px;
            font-weight: 500;
        }

        .balance-card-2d {
            background-color: var(--primary); /* Color s√≥lido para efecto 2D */
            padding: 24px;
            border-radius: 12px; /* Menos redondeado para estilo t√©cnico */
            text-align: center;
        }

        .balance-label { font-size: 0.85rem; opacity: 0.9; }
        .balance-amount { font-size: 2.8rem; font-weight: 700; margin: 5px 0; letter-spacing: -1px; }

        /* --- ENERG√çA FLAT --- */
        .energy-box { margin-top: 15px; }
        .energy-text { font-size: 0.75rem; margin-bottom: 5px; }
        .energy-bar-bg {
            background: rgba(0,0,0,0.2);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        #energy-fill {
            background: var(--energy-yellow);
            height: 100%;
            width: 100%;
            border-radius: 4px;
        }

        /* --- EDIFICIO CENTRAL (Dashboard Flat) --- */
        .card-central-2d {
            width: 100%;
            max-width: 420px;
            background: var(--card-flat);
            border: 1px solid var(--primary); /* Borde simple sin brillo */
            border-radius: 12px;
            padding: 16px;
            margin-top: 20px;
            display: flex;
            align-items: center;
            box-sizing: border-box;
        }

        .icon-square {
            font-size: 24px;
            margin-right: 15px;
        }

        /* --- GRILLA DE NEGOCIOS 2D --- */
        .negocios-grid {
            width: 100%;
            max-width: 420px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-top: 15px;
        }

        .negocio-item-2d {
            background: var(--card-flat);
            border: 1px solid var(--border-color);
            padding: 20px 10px;
            border-radius: 12px;
            text-align: center;
            transition: background 0.2s;
        }

        .negocio-item-2d:active { background: #242f3d; }
        .negocio-label { display: block; margin-top: 8px; font-size: 0.9rem; font-weight: 500; }

        /* --- MODAL FLAT --- */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); /* Oscurecido s√≥lido */
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content-2d {
            background: var(--card-flat);
            border: 1px solid var(--border-color);
            padding: 24px;
            border-radius: 16px;
            width: 85%;
            max-width: 340px;
        }

        .modal-title { margin-top: 0; font-size: 1.2rem; border-bottom: 1px solid var(--border-color); padding-bottom: 10px; }

        .business-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-color);
            font-size: 0.9rem;
        }

        .profit-2d { color: var(--accent-green); font-weight: 600; }
        
        .btn-flat {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px;
            width: 100%;
            border-radius: 8px;
            margin-top: 20px;
            font-weight: 600;
            cursor: pointer;
        }

    </style>
</head>
<body>

    <div class="header">
        <div id="user-display">@Usuario_Ton</div>
        <div class="balance-card-2d">
            <div class="balance-label">Balance TON</div>
            <div class="balance-amount" id="balance">0.0000</div>
            
            <div class="energy-box">
                <div class="energy-text">Energ√≠a: <span id="energy-val">1000 / 1000</span></div>
                <div class="energy-bar-bg">
                    <div id="energy-fill"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="card-central-2d" onclick="abrirDetalles()">
        <div class="icon-square">üè¢</div>
        <div>
            <div style="font-weight: bold; font-size: 1rem;">Edificio Central</div>
            <div style="font-size: 0.75rem; color: var(--text-dim);">Balance y datos de negocios</div>
        </div>
    </div>

    <div class="negocios-grid">
        <div class="negocio-item-2d"><span>üè¶</span><span class="negocio-label">Banco</span></div>
        <div class="negocio-item-2d"><span>üõí</span><span class="negocio-label">Tienda</span></div>
        <div class="negocio-item-2d"><span>üé∞</span><span class="negocio-label">Casino</span></div>
        <div class="negocio-item-2d"><span>üèä</span><span class="negocio-label">Piscinas</span></div>
    </div>

    <div id="modal-central" class="modal">
        <div class="modal-content-2d">
            <h3 class="modal-title">Estado de la Ciudad</h3>
            <div id="lista-negocios">
                </div>
            <div style="display: flex; justify-content: space-between; margin-top: 15px; font-weight: bold;">
                <span>Total (80%)</span>
                <span id="total-neto" class="profit-2d">0.0000 TON/h</span>
            </div>
            <button class="btn-flat" onclick="cerrarModal()">Entendido</button>
        </div>
    </div>

    <script>
        const REPARTO_USUARIO = 0.80;
        
        // Datos de ejemplo para visualizar
        const negocios = [
            { nombre: "Banco", prod: 0.0150 },
            { nombre: "Tienda", prod: 0.0050 },
            { nombre: "Casino", prod: 0.0500 },
            { nombre: "Piscinas", prod: 0.0200 }
        ];

        function abrirDetalles() {
            const container = document.getElementById('lista-negocios');
            let suma = 0;
            container.innerHTML = "";

            negocios.forEach(n => {
                const neto = n.prod * REPARTO_USUARIO;
                suma += neto;
                container.innerHTML += `
                    <div class="business-row">
                        <span>${n.nombre}</span>
                        <span class="profit-2d">+${neto.toFixed(4)}</span>
                    </div>`;
            });

            document.getElementById('total-neto').innerText = `${suma.toFixed(4)} TON/h`;
            document.getElementById('modal-central').style.display = 'flex';
        }

        function cerrarModal() {
            document.getElementById('modal-central').style.display = 'none';
        }
    </script>
</body>
</html>
